/* =========================================================
   Global foundations
   ========================================================= */

html {
  scroll-behavior: smooth;
  background-color: black;
}

body {
  background: transparent;
  color: $white;
  cursor: url("/img/dust-wave-square-cursor.svg"), auto !important;
}

body.fixednav { margin-top: 108px; }

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce) {
  body#glitch-target.glitching::before { animation: none !important; }
}

/* Utility spacing */
.py-vh-4 { padding-top: 4vh; padding-bottom: 4vh; }
@media (max-width: 540px) {
  .py-vh-4 { padding-top: 2vh !important; padding-bottom: 2vh !important; }
}

/* =========================================================
   Glitch background layer
   - Never animate/transform <body> itself
   - Animate fixed ::before overlay under content
   ========================================================= */

body.glitching { animation: none !important; transform: none !important; }

body#glitch-target {
  position: relative;
  isolation: isolate; /* new stacking context for ::before */
}

body#glitch-target::before {
  content: "";
  position: fixed;
  inset: -24px;                         /* overscan to hide edges while shaking */
  z-index: -1;                          /* sits behind page content */
  pointer-events: none;
  background-image:
    linear-gradient(0deg, rgba(255,255,255,.015), rgba(0,0,0,.015)), /* faint grain */
    var(--glitch-bg, url("../img/intro.gif"));                        /* default */
  background-repeat: no-repeat, no-repeat;
  background-size: 100% 100%, cover;
  background-position: 0 0, center;
  will-change: transform, filter, background-position;
  transform: translateZ(0);
  opacity: .96;
}

/* Stronger, very visible motion; tune custom properties to taste */
body#glitch-target.glitching::before {
  --g-amp: 14px;   /* shake amplitude */
  --g-pan: 60px;   /* x pan across the image by end of cycle */
  animation: glitch-anim-strong .22s steps(2, end) infinite alternate-reverse;
}

/* Big, spiky motion keyframes (visual only; no layout changes) */
@keyframes glitch-anim-strong {
  0%   { transform: translate3d(0,0,0) scale(1.018); filter: none; opacity: 1; background-position: 0 0, center; }
  10%  { transform: translate3d(calc(var(--g-amp)*-1),  calc(var(--g-amp)*.6), 0) rotate(.22deg); }
  20%  { transform: translate3d(calc(var(--g-amp)),     calc(var(--g-amp)*-.6),0); }
  30%  { transform: translate3d(calc(var(--g-amp)*-1.2),calc(var(--g-amp)*.35),0); filter: hue-rotate(14deg) saturate(1.25); }
  40%  { transform: translate3d(calc(var(--g-amp)*1.2), calc(var(--g-amp)*-.35),0); filter: hue-rotate(0deg); }
  55%  { transform: translate3d(calc(var(--g-amp)*-.7), 0, 0); }
  65%  { transform: translate3d(calc(var(--g-amp)*.9),  calc(var(--g-amp)*.7), 0) skewX(-3deg); opacity: .93; }
  75%  { transform: translate3d(0, calc(var(--g-amp)*-.7), 0) skewY(1.2deg); opacity: 1; }
  86%  { transform: translate3d(calc(var(--g-amp)*.35), 0, 0); }
  100% { transform: translate3d(0,0,0) scale(1.018); filter: none; background-position: var(--g-pan) 0, center; }
}

/* GIF hover swaps (scoped to body#glitch-target) */
html:has(.Red-Pillow:hover)                          body#glitch-target { --glitch-bg: url(../img/redpillow.gif); }
html:has(.High-Times-at-the-Ranger-Bowl-a-Rama:hover)body#glitch-target { --glitch-bg: url(../img/hightimes.gif); }
html:has(.VitaLifeÂ©-Chips:hover)                     body#glitch-target { --glitch-bg: url(../img/vitalife.gif); }
html:has(.La-Grima:hover)                            body#glitch-target { --glitch-bg: url(../img/lagrima.gif); }
html:has(.Mike-Mysteries:hover)                      body#glitch-target { --glitch-bg: url(../img/mikemysteries.gif); }
html:has(.Fronteras-Micro-film-Festival:hover)       body#glitch-target { --glitch-bg: url(../img/fronteras.gif); }
html:has(.Bag-Check:hover)                           body#glitch-target { --glitch-bg: url(../img/bagcheck.gif); }
html:has(.The-Green-Chile-Bagel:hover)               body#glitch-target { --glitch-bg: url(../img/greenchilebagel.gif); }
html:has(.The-Darkest-Place:hover)                   body#glitch-target { --glitch-bg: url(../img/darkestplace.gif); }
html:has(.They-Came-From-Planet-X:hover)             body#glitch-target { --glitch-bg: url(../img/planetx.gif); }
html:has(.Gumshoe:hover)                             body#glitch-target { --glitch-bg: url(../img/gumshoe.gif); }
html:has(.Fumbled-Not-Stirred:hover)                 body#glitch-target { --glitch-bg: url(../img/fumblednotstirred.gif); }
html:has(.Accessory-to-Murder:hover)                 body#glitch-target { --glitch-bg: url(../img/accessory.gif); }
html:has(.The-Converger:hover)                       body#glitch-target { --glitch-bg: url(../img/converger.gif); }
html:has(.The-Dust-Wave-Show:hover)                  body#glitch-target { --glitch-bg: url(../img/thedustwaveshow.gif); }
html:has(.The-Haunters:hover)                        body#glitch-target { --glitch-bg: url(../img/haunters.gif); }
html:has(.Earworm:hover)                             body#glitch-target { --glitch-bg: url(../img/earworm.gif); }
html:has(.Dive-In-Movies:hover)                      body#glitch-target { --glitch-bg: url(../img/divein.gif); }
html:has(.Movie-Monsters:hover)                      body#glitch-target { --glitch-bg: url(../img/moviemonsters.gif); }
html:has(.Softening:hover)                           body#glitch-target { --glitch-bg: url(../img/softening.gif); }
html:has(.Shellfish-Knish:hover)                     body#glitch-target { --glitch-bg: url(../img/shellfishknish.gif); }
html:has(.An-Evening-of-Frights-and-Delights:hover)  body#glitch-target { --glitch-bg: url(../img/evening.gif); }
html:has(.Frograiser:hover)                          body#glitch-target { --glitch-bg: url(../img/frograiser.gif); }
html:has(.Dust-Dont-Settle:hover)                    body#glitch-target { --glitch-bg: url(../img/dustdontsettle.gif); }
html:has(.Horseheads:hover)                          body#glitch-target { --glitch-bg: url(../img/horseheads.gif); }
html:has(.Horse-vs-Vamp:hover)                       body#glitch-target { --glitch-bg: url(../img/horsevsvamp.gif); }
html:has(.Long-Night:hover)                          body#glitch-target { --glitch-bg: url(../img/longnight.gif); }
html:has(.Pandoras-Greenhouse:hover)                 body#glitch-target { --glitch-bg: url(../img/pandora.gif); }

/* =========================================================
   Sitewide transitions / micro-interactions
   ========================================================= */

.btn,
.navbar-collapse.collapsing,
.megamenu.show,
.nav-link.collapsed,
.scrolled,
.shadow,
.shadow-light,
.preloader,
.navbar,
a,
a.link-line,
a.link-line:before,
a.hover-hide,
a.hover-content,
a.hover-hide::before,
.a.hover-hide .hover-content,
.navbar-collapse.collapse.show,
.navbar-light a.nav-link,
img {
  transition: all .5s ease-in-out 0s;
}

.transform-scale:hover { transform: scale(1.5, 1.5); }

/* =========================================================
   Typography & links
   ========================================================= */

h1,
main h1, main h2, main h3, main h4, main h5, main h6,
.gambado { font-family: 'Gambado-Sans', sans-serif; }

.display-big { font-size: 7rem; }
.display-huge { font-size: calc(2.5rem + 1.5vw); font-weight: 700; letter-spacing: -.02rem; }

.intro-content::first-letter {
  float: left;
  font-size: 4.5em;
  padding: .15em .25em 0 0;
  line-height: 4.5rem;
}

.link-fancy {
  color: $white;
  text-decoration: none !important;
  display: inline-block;
  position: relative;
}
.link-fancy:hover { color: $gray-600; }
.link-fancy:before {
  content: '';
  display: block;
  height: 1px;
  width: 100%;
  transform-origin: left;
  position: absolute;
  left: 0; bottom: 0;
  background-repeat: no-repeat;
  background-position: 0;
  background-size: 400% 1px;
  transition: background-position .8s ease-in-out;
}
.link-fancy:hover:before { background-position: 100%; }

a { color: $white !important; }
a:hover { color: gray !important; }

.caption { text-align: center; font-size: smaller; }
.date-written { text-align: left; font-style: italic; font-size: smaller; }

.blockquote-xl { font-size: calc(1rem + 1vw); font-style: italic; font-weight: bolder; }

/* Ordered lists */
ol li::marker { font-weight: bold; }
ol li { padding-inline-start: 15px; }

/* Unordered lists (global) */
ul { margin-bottom: 2rem; }
li { margin-left: 2rem !important; margin-bottom: 0 !important; }
.indent { margin-left: 4rem !important; }
.indentmore { margin-left: 6rem !important; }

/* =========================================================
   Layout helpers
   ========================================================= */

.bg-cover { background-size: cover; background-position: center center; }
.container { width: 90% !important; }
.container-100 { width: 100% !important; padding: 0 2% 0 2%; }
.no-bs-gutter { --bs-gutter-x: 0; }
.center-span { display: table; margin: 0 auto; }
.drop-shadow { filter: drop-shadow(0px 10px 10px rgba(0,0,0,.6)); }
.dropshadow {
  border: 1px solid #CCC;
  box-shadow: 3px 3px 1px #f5f5f5;
  -moz-box-shadow: 3px 3px 1px #f5f5f5;
  -webkit-box-shadow: 3px 3px 1px #f5f5f5;
  border-radius: 5px;
}
li p { margin-bottom: 0; }

/* =========================================================
   Navbar / navigation (desktop-first)
   ========================================================= */

.navbar {
  padding-top: 32px;
  padding-bottom: 32px;
  max-width: 992px;
}
.navbar.scrolled { padding-top: 12px; padding-bottom: 12px; background-color: rgba(255,255,255,.9); }

.navbar-light a.nav-link {
  color: $black;
  border-bottom: 2px solid transparent;
  margin: 0 1.4rem;
  font-size: 1.2rem;
}
.navbar-expand-lg .navbar-nav a.nav-link { padding-left: 0; padding-right: 0; }

.nav-link { line-height: 1.5; padding: .75rem 1rem; }
.navbar-nav li { margin-left: 0 !important; }

.navbar-toggler-icon {
  background-image: url("data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='white' stroke-width='2' stroke-linecap='round' stroke-miterlimit='10' d='M4 7h22M4 15h22M4 23h22'/%3E%3C/svg%3E");
}
.navbar-collapse { background-color: transparent !important; padding: 0; border: none; }
.navbar-collapse.collapsing,
.navbar-collapse.collapse.show { background-color: $white; padding: 10px; }

/* Mobile navbar behavior */
@media (max-width: 991.98px) {
  .navbar { justify-content: center !important; }
  .navbar-toggler { margin-left: auto; margin-right: auto; }

  .navbar-collapse {
    overflow: hidden;
    max-height: 0;
    opacity: 0;
    transform: translateY(-10px);
    transition: max-height 250ms ease-out, opacity 200ms ease-out, transform 200ms ease-out;
    display: flex !important;
    flex-direction: column;
    align-items: center;
    width: 80%;
    justify-content: center;
  }
  .navbar-collapse.show {
    max-height: 500px;
    opacity: 1;
    transform: translateY(0);
  }

  .navbar-brand { width: 20%; display: flex; align-items: center; }
  .navbar-nav { align-items: center; text-align: center; }
  .navbar-collapse .nav-item { margin: .5rem 0; }
}

/* Hamburger icon & toggle */
.hamb { cursor: pointer; float: right; padding: 40px 20px; }
.hamb-line {
  background: var(--white);
  display: block; height: 2px; width: 24px; position: relative;
}
.hamb-line::before, .hamb-line::after {
  background: var(--white);
  content: '';
  display: block;
  height: 100%; width: 100%;
  position: absolute;
  transition: all .2s ease-out;
}
.hamb-line::before { top: 5px; }
.hamb-line::after { top: -5px; }

.side-menu { display: none; }
.side-menu:checked ~ nav { max-height: 100%; }
.side-menu:checked ~ .hamb .hamb-line { background: transparent; }
.side-menu:checked ~ .hamb .hamb-line::before { transform: rotate(-45deg); top: 0; }
.side-menu:checked ~ .hamb .hamb-line::after  { transform: rotate(45deg);  top: 0; }

/* Collapse animation opt-out (matches Bootstrap quirks) */
.collapse { transition: none !important; }

/* Spacing tweaks on very small screens */
@media (max-width: 540px) {
  .navbar { padding-top: 10px; padding-bottom: 10px; }
}

/* Columns padding tweaks */
#navbar-items-column { padding-left: 4vw; }
@media only screen and (max-width: 1024px) {
  #navbar-items-column { padding-left: 0; }
}

/* Footer scale across breakpoints */
#footer-items-column { font-size: 1.1rem; }
@media only screen and (max-width: 1024px) { #footer-items-column { font-size: .9rem; } }
@media only screen and (max-width: 515px)  { #footer-items-column { font-size: .7rem; } }
@media only screen and (max-width: 330px)  { #footer-items-column { font-size: .65rem; } }

/* =========================================================
   Page-specific: News & Partners (fixed backgrounds)
   ========================================================= */

.news,
.partners {
  text-shadow: 2px 2px #000000;
  color: white !important;
}

.news-background {
  background-image: url("../img/news.gif");
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center center;
  height: 100vh; width: 100vw;
  top: 0; position: fixed; z-index: -1;
}

.partners-background {
  background-image: url("../img/partners.gif");
  background-size: cover;
  background-repeat: no-repeat;
  background-position: center center;
  height: 100vh; width: 100vw;
  top: 0; position: fixed; z-index: -1;
  opacity: 80%;
}

/* =========================================================
   Popup / newsletter (Mailchimp)
   ========================================================= */

#popup {
  position: fixed;
  left: 50%; transform: translateX(-50%);
  width: 97%; bottom: 5px;
  opacity: 0;
  transition: all .3s ease-in-out;
  z-index: 10000;
  isolation: isolate; /* new stacking context */
  contain: paint;
}
#popup.show { height: auto; opacity: 1; }

.popup-content {
  background-color: #f5f5f5;
  border: 1px solid #cccccc;
  border-radius: 5px;
  box-shadow: 0 0 10px rgba(0,0,0,.2);
  margin: 0 auto; padding: 10px;
  max-width: 500px; position: relative;
  color: black !important;
  text-shadow: none !important;
}

@media (min-width: 700px) {
  #popup { width: 480px; max-width: 95vw; bottom: 30px; left: 50%; transform: translateX(-50%); }
  .popup-content { max-height: 70vh; overflow-y: auto; }
}

#popup, #popup * { filter: none !important; mix-blend-mode: normal !important; }

.close-btn {
  position: absolute; top: 5px; right: 10px;
  font-size: 24px; font-weight: bold;
  background: transparent; border: none; outline: none; cursor: pointer;
}

#mc_embed_signup { max-width: 600px; clear: left; font-size: smaller; }
.brandingLogo { display: none; }

input[type=submit] {
  font-family: 'Gambado-Sans', sans-serif;
  background-color: black !important;
  color: white !important;
  margin-top: 10px;
  border-color: black;
  border-radius: 4px;
  padding: 0 22px;
  line-height: 32px;
}

.mce_inline_error,
#mce-EMAIL-HELPERTEXT { background-color: #f5f5f5 !important; }

.mc-field-group { padding-top: 3%; }

/* Lazy fade-in helper */
.lazyload { visibility: hidden; opacity: 0; transition: visibility 0s, opacity .5s ease; }
.lazyload.show { visibility: visible; opacity: 1; }

/* =========================================================
   Images / overlays (Partners grid etc.)
   ========================================================= */

.image_wrapper { position: relative; }
.partners .image_wrapper img { padding: 10px; }

.overlay {
  position: absolute;
  background: rgba(57,57,57,.5);
  display: flex; align-items: center; justify-content: center;
  @media only screen and (max-width: 1024px) { align-items: end; }
}

.overlay_3 {
  left: 0; bottom: 100%;
  height: 0; width: 100%;
  overflow: hidden;
  backdrop-filter: blur(2px) brightness(80%);
  transition: all .3s ease-in-out;
  @media only screen and (max-width: 1024px) {
    bottom: 0; height: 100%;
    backdrop-filter: blur(0px) brightness(99%);
  }
}
.image_wrapper:hover .overlay_3 { bottom: 0; height: 100%; }

.overlay-partner {
  flex-direction: column;
  background: transparent;
  backdrop-filter: blur(5px) brightness(40%);
  border-radius: 5px;
  @media only screen and (max-width: 1024px) {
    flex-direction: row;
    bottom: 0; height: 100%;
    backdrop-filter: blur(0px) brightness(99%);
    display: none; /* hide on mobile (original behavior preserved) */
  }
}
.overlay-partner .partner-title { padding: 10px; }

.overlay_3 h3 { @media only screen and (max-width: 1024px) { margin-bottom: 25px; } }

/* =========================================================
   Buttons & motion bits
   ========================================================= */

button i { padding-right: .3vw; }
.newsletter-button { background-color: white; }

#sticky-button {
  background-color: black; color: white;
  position: absolute; border-color: white; border-radius: 3px;
  opacity: .4; animation: ball 25s infinite linear;
  @media screen and (max-width: 1024px) {
    animation: unset; opacity: 1; position: relative;
    display: block; margin: 40px auto 0; transform: none;
  }
}
#sticky-button:hover {
  transition: all .5s ease-in-out 0s;
  transform: scale(1.05, 1.05);
  opacity: 1; animation-play-state: paused;
}

@keyframes ball {
  0%   { top: 40%; left: 10%; opacity: .1; }
  10%  { top: 60%; left: 5%;  opacity: 1;  }
  20%  { top: 80%; left: 7%;  opacity: .1; }
  30%  { top: 66%; left: 2%;  opacity: 1;  }
  40%  { top: 55%; left: 27%; opacity: .1; }
  50%  { top: 44%; left: 65%; opacity: 1;  }
  60%  { top: 60%; left: 70%; opacity: .1; }
  70%  { top: 55%; left: 75%; opacity: 1;  }
  80%  { top: 68%; left: 65%; opacity: .1; }
  90%  { top: 35%; left: 80%; opacity: 1;  }
  100% { top: 40%; left: 10%; opacity: .1; }
}

/* Anchor wrapping a button (no underline) */
a:has(button) { text-decoration: none; }

/* =========================================================
   Forms
   ========================================================= */

.contact-form {
  margin: 0 auto 20px auto; width: 100%; max-width: 90%; padding: 20px;
  &:first-child { margin-top: 0; }
}
.contact-form__item {
  margin-top: 15px;
  &:first-child { margin-top: 0; }
}
.contact-form__item--error .contact-form__input,
.contact-form__item--error .contact-form__textarea { border-color: red; }

.contact-form__label { display: block; }

.contact-form__input,
.contact-form__textarea {
  width: 100%; margin-top: 8px;
  border: 2px solid; border-radius: 2px;
  padding: 10px 12px; line-height: 1.4;
  @include transition(all .15s ease-in-out);
  &:focus { outline: none; }
}

::-webkit-input-placeholder { color: grey; }
::-moz-placeholder         { color: grey; }
:-ms-input-placeholder     { color: grey; }
:-moz-placeholder          { color: grey; }

.contact-form__textarea { min-height: 200px; resize: none; }
.border-color-white { border-color: white !important; }

.survey .contact-form__item label { font-size: smaller; }

/* =========================================================
   Page-specific helpers
   ========================================================= */

.white-text { color: white !important; }
.test      { text-shadow: 2px 2px #000; color: white !important; background-color: black; }
article h2 { width: 60%; }

/* =========================================================
   DIY Filmmaker Digest â Shared blocks
   ========================================================= */

/* Generic responsive embed helper */
.embed-container {
  position: relative;
  padding-bottom: 56.25%; /* 16:9 */
  height: 0; overflow: hidden; max-width: 100%;
  border-radius: .5rem;
}
.embed-container iframe,
.embed-container object,
.embed-container embed {
  position: absolute; top: 0; left: 0;
  width: 100%; height: 100%;
  border: 0; border-radius: .5rem; padding: 10px;
}

/* Lite YouTube embed */
.embed-lite__ratio {
  position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;
  border-radius: .5rem; box-shadow: 0 6px 16px rgba(0,0,0,.08);
}
.embed-lite, .embed-lite__iframe { position: absolute; inset: 0; width: 100%; height: 100%; }
.embed-lite {
  display: block; border: 0; background: #000; cursor: pointer; border-radius: .5rem;
}
.embed-lite__thumb {
  width: 100%; height: 100%; object-fit: cover; filter: brightness(.8); border-radius: .5rem;
}
.embed-lite__play {
  position: absolute; left: 50%; top: 50%;
  width: 68px; height: 48px; transform: translate(-50%, -50%);
  opacity: .9; transition: transform .2s ease, opacity .2s ease;
  background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="68" height="48" viewBox="0 0 68 48"><path fill="%23000" d="M66.52 7.66a8 8 0 0 0-5.64-5.66C56.1.8 34 .8 34 .8s-22.1 0-26.88 1.2A8 8 0 0 0 1.48 7.66C.3 12.46.3 24 .3 24s0 11.54 1.18 16.34a8 8 0 0 0 5.64 5.66C12.9 47.2 35 47.2 35 47.2s22.1 0 26.88-1.2a8 8 0 0 0 5.64-5.66C68.7 35.54 68.7 24 68.7 24s0-11.54-1.18-16.34Z"/><path fill="%23fff" d="M27 34V14l18 10-18 10z"/></svg>') center / contain no-repeat;
}
.embed-lite:hover .embed-lite__play { transform: translate(-50%, -50%) scale(1.05); opacity: 1; }

/* Digest grids: column containers that JS âequalizesâ */
#articles-grid.equalize,
#trailers-grid.equalize,
#av-grid.equalize { /* marker only */ }

#articles-grid .col-left,
#articles-grid .col-right,
#trailers-grid .col-left,
#trailers-grid .col-right,
#av-grid .col-left,
#av-grid .col-right {
  display: flex; flex-direction: column; gap: 1rem;
}

/* Cards */
.digest-card {
  background-color: unset; color: unset;
  border: 1px solid rgba(0,0,0,.08);
  border-radius: .5rem;
  box-shadow: 0 6px 16px rgba(0,0,0,.08);
}
.digest-card img.rounded-top,
.digest-card > img { display: block; border-radius: .5rem; }

/* Neutralize site text-shadow inside cards */
.digest-card h4, .digest-card h5, .digest-card h6,
.digest-card p, .digest-card li, .digest-card blockquote { text-shadow: none !important; }

/* Links inside cards override global white links */
.digest-card a { text-decoration: underline; text-decoration-thickness: 1px; text-underline-offset: 2px; }
.digest-card a:hover { color: #555 !important; }

/* Pull-quotes */
.digest-card blockquote {
  font-style: italic; font-weight: 700; line-height: 1.35;
  margin: 0 0 .75rem 0; padding: .5rem 0 .5rem 1rem; border-left: 4px solid #111;
}

/* Lists inside cards */
.digest-card ul { margin: .5rem 0 1rem; padding-left: 1.15rem; }
.digest-card li { margin-left: 0 !important; margin-bottom: .25rem !important; }

/* Hover lift */
.digest-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 22px rgba(0,0,0,.12);
  transition: transform .2s ease, box-shadow .2s ease;
}

/* Spotify iframes on light cards */
.digest-card iframe[src*="open.spotify.com"] { background: transparent; border-radius: .5rem; }

/* Responsive painting to avoid jank on long columns */
#trailers-grid .col-left, #trailers-grid .col-right {
  content-visibility: auto; contain-intrinsic-size: 1px 2000px;
}
#av-grid .col-left, #av-grid .col-right {
  content-visibility: auto; contain-intrinsic-size: 1px 1200px;
}

/* AV grid card layout */
#av-grid .digest-card { display: flex; flex-direction: column; min-height: 0; }
#av-grid .digest-card .embed-container { margin-bottom: .5rem; }
#av-grid .digest-card > .embed-container { aspect-ratio: 16/9; flex: 0 0 auto; margin-top: 0; }
#av-grid .digest-card > .p-3 { flex: 1 1 auto; display: flex; flex-direction: column; }
#av-grid .digest-card .mb-2:last-child { margin-bottom: 0 !important; }

/* TOC */
.digest-toc { margin-bottom: 1.25rem; }
.digest-toc h4 { font-size: 1.15rem; line-height: 1.2; }
.digest-toc section + section h3 { margin-top: 2rem; }
.digest-toc__list { list-style: disc outside; margin: .25rem 0 1rem 1.25rem; padding: 0; }
.digest-toc__item { line-height: 1.35; margin: .25rem 0; display: list-item; }
.digest-toc__link { text-decoration: underline; text-underline-offset: 2px; text-decoration-thickness: 1px; color: inherit; }
.digest-toc__link:hover { text-decoration-thickness: 2px; color: #bbb !important; }
.digest-toc__link:visited { opacity: .85; }

/* To-Do list (static checkboxes) */
.todo-list { list-style: none; margin: .5rem 0 1rem; padding-left: 1.15rem; }
.todo-list li {
  position: relative; margin-left: 0 !important; margin-bottom: .25rem !important;
  padding-left: 1.6rem; line-height: 1.4;
  transition: transform .08s ease;
}
.todo-list li::before {
  content: ""; position: absolute; left: 0; top: .28rem;
  width: 1rem; height: 1rem;
  border: 2px solid currentColor; border-radius: 3px; box-sizing: border-box;
  transition: background-color .15s ease, box-shadow .15s ease, transform .08s ease;
}
.todo-list li:hover::before { background-color: currentColor; box-shadow: 0 0 0 1px currentColor inset; }
.todo-list li:focus-within::before { outline: 2px solid currentColor; outline-offset: 2px; }
.todo-list li.checked::before { background-color: currentColor; box-shadow: 0 0 0 1px currentColor inset; }
.todo-list li.checked { text-decoration: line-through; opacity: .8; }

/* Desktop spacing tweaks / subtle dividers */
@media (min-width: 992px) {
  #av-grid .digest-card > .embed-container { margin-bottom: .25rem; }
  #av-grid .digest-card > .p-3 { padding-top: .5rem; }
  #articles-grid .digest-card > .p-3 { padding-top: .5rem; }

  #trailers-grid .embed-container { margin-bottom: .35rem; }
  #trailers-grid .caption { margin-top: .25rem; }
}

/* Mobile: lighter shadows */
@media (max-width: 991.98px) {
  #articles-grid .col-left, #articles-grid .col-right,
  #trailers-grid .col-left, #trailers-grid .col-right,
  #av-grid .col-left, #av-grid .col-right { gap: 1rem; }
  .digest-card { box-shadow: 0 4px 12px rgba(0,0,0,.1); }
}

/* Uniform cards for images/embeds on desktop */
:root {
  --digest-card-h: 520px;       /* total card height (reference) */
  --digest-img-ratio: 16/9;     /* top media aspect ratio */
}
#articles-grid .digest-card, #av-grid .digest-card { display: flex; flex-direction: column; min-height: 0; }
#articles-grid .digest-card > img {
  width: 100%; aspect-ratio: var(--digest-img-ratio); object-fit: cover; flex: 0 0 auto;
  border-bottom-left-radius: 0; border-bottom-right-radius: 0;
}
#av-grid .digest-card > .embed-container { aspect-ratio: var(--digest-img-ratio); flex: 0 0 auto; margin-bottom: .25rem; }

/* Subtle dividers between stacked cards */
#articles-grid .col-left .digest-card + .digest-card,
#articles-grid .col-right .digest-card + .digest-card,
#av-grid .col-left .digest-card + .digest-card,
#av-grid .col-right .digest-card + .digest-card {
  position: relative; margin-top: .25rem; padding-top: 2rem;
}
#articles-grid .col-left .digest-card + .digest-card::before,
#articles-grid .col-right .digest-card + .digest-card::before,
#av-grid .col-left .digest-card + .digest-card::before,
#av-grid .col-right .digest-card + .digest-card::before {
  content: ""; position: absolute; top: 0; left: 5rem; right: 5rem; height: 1px;
  background-color: rgba(255,255,255,.6);
}

/* =========================================================
   Podcast Audio Card (compact, dark)
   ========================================================= */

:root{
  --audio-bg: #0f0f0f; --audio-fg: #f2f2f2; --audio-subtle: #bdbdbd;
  --audio-accent: #ffd54d; --audio-border: rgba(255,255,255,.08);
  --audio-ra: 12px; --audio-h: 200px;
  --card-py: 10px; --card-px: 12px;                 /* internal padding */
  --wave-progress: #f2f2f2; --wave-backdrop: rgba(255,255,255,.2); --wave-cursor: #ffd54d;
  --art-h: calc(var(--audio-h) - (var(--card-py) * 2));
  --art-w: var(--art-h);
}

.audio-card{
  display:flex; align-items:stretch; gap:14px;
  height:var(--audio-h); padding:var(--card-py) var(--card-px);
  border:1px solid var(--audio-border); border-radius:var(--audio-ra);
  background:var(--audio-bg); color:var(--audio-fg);
  box-shadow:0 6px 16px rgba(0,0,0,.18);
  font-family:"gambado-sans", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  font-size:.95rem; overflow:hidden; overscroll-behavior: contain; overflow-anchor: none;
}
.audio-card, .audio-card * { scroll-behavior: auto !important; }
.audio-card * { -webkit-tap-highlight-color: transparent; }
.audio-card button { touch-action: manipulation; }

.audio-card .art-col{ flex:0 0 var(--art-w); display:flex; align-items:center; justify-content:center; min-height:0; }
.audio-card .art-col > img{
  width:var(--art-w); height:var(--art-h); object-fit:cover; border-radius:10px; background:#151515; display:block;
}

.audio-card > div:not(.art-col){ flex:1 1 auto; min-width:0; min-height:0; display:flex; flex-direction:column; justify-content:flex-start; }

.audio-card .wave{
  height: calc(var(--audio-h) * 0.65);
  flex: 0 0 calc(var(--audio-h) * 0.65);
  margin: 0; overflow-x: hidden; overflow-y: hidden; overscroll-behavior-x: contain; scrollbar-width: none; position: relative;
}
.audio-card .wave wave{ display:block; }
.audio-card .wave .wavesurfer-region, .audio-card .wave .wavesurfer-handle{ display:none; }
.audio-card audio{ display:none !important; }

/* Controls row */
.audio-card .controls{
  flex: 0 0 auto; margin-block: auto; display: flex !important; align-items: center; justify-content: center;
  gap: 8px; width: 100%; line-height: 0; margin-top: 7px; row-gap: 6px; /* row-gap helps when wrapping */
}

/* Buttons */
.audio-card .controls button{
  -webkit-appearance:none; appearance:none;
  background:transparent !important; color:var(--audio-fg) !important;
  border:1px solid var(--audio-border); border-radius:999px;
  display:grid; place-items:center; margin:0; padding:0; box-sizing:border-box; vertical-align:middle; align-self:center;
  box-shadow:0 2px 8px rgba(0,0,0,.25);
  transition: transform .08s ease, box-shadow .12s ease, background .12s ease, border-color .12s ease;
}
.audio-card .controls button:hover  { background:rgba(255,255,255,.05); transform:translateY(-1px); box-shadow:0 4px 12px rgba(0,0,0,.28); }
.audio-card .controls button:active { transform:translateY(0); box-shadow:0 2px 8px rgba(0,0,0,.2) inset; }

.audio-card .controls button:not([data-audio-speed]){ width:40px; height:40px; font-size:0; }
.audio-card .controls button:not([data-audio-speed]) svg{ width:20px; height:20px; display:block; fill:currentColor; }
.audio-card .controls button:not([data-audio-speed]) svg rect{ display:none !important; }

.audio-card .controls [data-audio-speed]{
  height:40px; min-width:40px; padding:0 10px;
  line-height:1; font-family:"Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  font-size:.68rem; font-weight:600;
}

/* No-art case */
.audio-card .art-col > img[src=""], .audio-card .art-col > img:not([src]){ display:none; }

/* Kill stray <p> margins that sometimes appear */
.audio-card > div:not(.art-col) > p{ margin:0 !important; }
.audio-card > div:not(.art-col) > p:empty { display: none; }

/* Wave skeleton / fallback */
.wave.wave--skeleton{
  position: relative;
  background: linear-gradient(90deg, rgba(255,255,255,.08), rgba(255,255,255,.12), rgba(255,255,255,.08));
  background-size: 240px 100%;
  animation: waveShimmer 1.2s linear infinite;
  border-radius: 6px;
}
@keyframes waveShimmer { 0% { background-position: -240px 0; } 100% { background-position: 240px 0; } }

.wave--fallback { position: relative; }
.wave--fallback .fallback-bar{
  position:absolute; inset:auto 0 0 0; height:3px;
  background:var(--wave-cursor,#ffd54d); transform-origin:left center; transform:scaleX(0); opacity:.9;
}
.wave__overlay{ position:absolute; inset:0; z-index:2; background:transparent; }
.wave--loading  { overflow-x: hidden; }

.wave--fallback .play-hint {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  display: flex; align-items: center; justify-content: center;
  width: 64px; height: 64px; border-radius: 50%; cursor: pointer;
  background: rgba(0, 0, 0, .55); color: #fff; border: 1px solid rgba(255,255,255,.15);
  box-shadow: 0 2px 8px rgba(0,0,0,.25); z-index: 3;
}
.play-hint { transition: opacity .3s ease; }
.play-hint.hidden { opacity: 0; pointer-events: none; }

.audio-no-snap { scroll-snap-type: none !important; }
.audio-card .wave::-webkit-scrollbar { display:none; } /* WebKit */

/* Mobile sizes for audio card */
@media (max-width: 420px){
  :root{ --audio-h: 148px; --art-size: calc(var(--audio-h) * .46); }
  .audio-card{ gap: 8px; padding: 8px; }
  :root{ --card-py: 8px; --card-px: 8px; --art-h: calc(var(--audio-h) - (var(--card-py) * 2)); --art-w: var(--art-h); }
  .audio-card .wave{ height: calc(var(--audio-h) * .58); flex-basis: calc(var(--audio-h) * .58); }
  .audio-card .controls{ justify-content: center; margin-top: 12px; }
  .audio-card .controls button:not([data-audio-speed]){ width: 24px; height: 24px; }
  .audio-card .controls button:not([data-audio-speed]) svg{ width: 18px; height: 18px; }
  .audio-card .controls [data-audio-speed]{ height: 24px; min-width: 24px; padding: 0 5px; font-size: .5rem; font-weight: 700; }
  .audio-card .controls .playpause{ width: 24px; height: 24px; border-radius: 999px; display: grid; place-items: center; padding: 0; }
  .audio-card .controls .playpause svg{ width: 18px; height: 18px; }
}
@media (min-width: 421px) and (max-width: 540px){
  :root{ --audio-h: 160px; --art-size: calc(var(--audio-h) * .48); }
  .audio-card{ gap: 10px; padding: 8px; }
  .audio-card .controls{ gap: 10px; justify-content: center; }
  .audio-card .controls button:not([data-audio-speed]){ width: 38px; height: 38px; }
  .audio-card .controls button:not([data-audio-speed]) svg{ width: 19px; height: 19px; }
  .audio-card .controls .playpause{ width: 38px; height: 38px; }
  .audio-card .controls .playpause svg{ width: 19px; height: 19px; }
  .audio-card .controls [data-audio-speed]{ height: 38px; min-width: 38px; padding: 0 9px; font-size: .65rem; font-weight: 700; }
}