{# Social meta tags for Open Graph + Twitter Cards + Structured Data #}
{# Requires metadata.url to be set in _data/metadata.json #}

{% set pageTitle = title or metadata.title %}
{% set pageDescription = description or summary or metadata.description %}
{% set pageUrl = metadata.url + page.url %}

{# Determine OG image with fallback chain: og_image → img → default #}
{% if og_image %}
  {% set ogImage = metadata.url + og_image %}
{% elif img %}
  {% set ogImage = metadata.url + (img | toWebp) %}
{% else %}
  {% set ogImage = metadata.url + "/img/og/default.png" %}
{% endif %}

{% set ogAlt = og_alt or imgAlt or pageTitle %}

{# ═══════════════════════════════════════════════════════════════════════════ #}
{# OPEN GRAPH TAGS                                                             #}
{# ═══════════════════════════════════════════════════════════════════════════ #}

<meta property="og:type" content="{% if tags and ('posts' in tags or 'news' in tags) %}article{% else %}website{% endif %}">
<meta property="og:site_name" content="{{ metadata.brandName or metadata.title }}">
<meta property="og:title" content="{{ pageTitle }}">
<meta property="og:description" content="{{ pageDescription }}">
<meta property="og:url" content="{{ pageUrl }}">
<meta property="og:locale" content="{{ metadata.language | default('en') }}_US">

{# OG Image #}
<meta property="og:image" content="{{ ogImage }}">
<meta property="og:image:secure_url" content="{{ ogImage }}">
<meta property="og:image:alt" content="{{ ogAlt }}">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta property="og:image:type" content="image/{% if ogImage.endsWith('.png') %}png{% elif ogImage.endsWith('.webp') %}webp{% else %}jpeg{% endif %}">

{# Optional OG video (MP4 loop) #}
{% if og_video %}
<meta property="og:video" content="{{ metadata.url + og_video }}">
<meta property="og:video:secure_url" content="{{ metadata.url + og_video }}">
<meta property="og:video:type" content="video/mp4">
<meta property="og:video:width" content="1200">
<meta property="og:video:height" content="630">
{% endif %}

{# Article-specific OG tags (for posts and news) #}
{% if date %}
<meta property="article:published_time" content="{{ date | dateToRfc3339MT }}">
{% endif %}
{% if modified or updated %}
<meta property="article:modified_time" content="{{ (modified or updated) | dateToRfc3339MT }}">
{% endif %}
{% if author %}
<meta property="article:author" content="{{ author }}">
{% endif %}
<meta property="article:publisher" content="{{ metadata.url }}">
{% if tags %}
  {% for tag in tags | filterTagList %}
<meta property="article:tag" content="{{ tag }}">
  {% endfor %}
{% endif %}
{% if summary %}
<meta property="article:section" content="{% if tags and 'posts' in tags %}Films{% else %}News{% endif %}">
{% endif %}

{# ═══════════════════════════════════════════════════════════════════════════ #}
{# TWITTER CARD TAGS                                                           #}
{# ═══════════════════════════════════════════════════════════════════════════ #}

<meta name="twitter:card" content="summary_large_image">
{% if metadata.social.twitter %}
<meta name="twitter:site" content="{{ metadata.social.twitter }}">
<meta name="twitter:creator" content="{{ metadata.social.twitter }}">
{% endif %}
<meta name="twitter:title" content="{{ pageTitle }}">
<meta name="twitter:description" content="{{ pageDescription }}">
<meta name="twitter:image" content="{{ ogImage }}">
<meta name="twitter:image:alt" content="{{ ogAlt }}">
{% if og_video %}
<meta name="twitter:player" content="{{ metadata.url + og_video }}">
<meta name="twitter:player:width" content="1200">
<meta name="twitter:player:height" content="630">
{% endif %}

{# ═══════════════════════════════════════════════════════════════════════════ #}
{# ADDITIONAL PLATFORM TAGS                                                    #}
{# ═══════════════════════════════════════════════════════════════════════════ #}

{# Pinterest Rich Pins #}
<meta name="pinterest-rich-pin" content="true">

{# Slack unfurling (uses OG tags but these help) #}
<meta name="slack-app-id" content="">

{# Theme color for browser UI #}
<meta name="theme-color" content="{{ metadata.themeColor | default('#1a1a2e') }}">
<meta name="msapplication-TileColor" content="{{ metadata.themeColor | default('#1a1a2e') }}">

{# Apple-specific #}
<meta name="apple-mobile-web-app-title" content="{{ metadata.brandName or metadata.title }}">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

{# ═══════════════════════════════════════════════════════════════════════════ #}
{# CANONICAL & ALTERNATE LINKS                                                 #}
{# ═══════════════════════════════════════════════════════════════════════════ #}

<link rel="canonical" href="{{ pageUrl }}">

{# ═══════════════════════════════════════════════════════════════════════════ #}
{# JSON-LD STRUCTURED DATA                                                     #}
{# ═══════════════════════════════════════════════════════════════════════════ #}

{# Organization schema (on every page for brand recognition) #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "{{ metadata.brandName or metadata.title }}",
  "url": "{{ metadata.url }}",
  "logo": "{{ metadata.url }}/img/favicon/apple-touch-icon.png",
  "sameAs": [
    "https://www.instagram.com/{{ metadata.social.instagram | default('dustwavexyz') }}",
    "https://www.youtube.com/{{ metadata.social.youtube | default('@dustwavexyz') }}"
  ]
}
</script>

{# Article/CreativeWork schema for posts and news #}
{% if tags and ('posts' in tags or 'news' in tags) %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "{% if tags and 'posts' in tags %}Movie{% else %}Article{% endif %}",
  "headline": "{{ pageTitle | replace('"', '\\"') }}",
  "description": "{{ pageDescription | replace('"', '\\"') }}",
  "image": "{{ ogImage }}",
  "url": "{{ pageUrl }}",
  "datePublished": "{{ date | dateToRfc3339MT }}",
  {% if modified or updated %}"dateModified": "{{ (modified or updated) | dateToRfc3339MT }}",{% endif %}
  "author": {
    "@type": "{% if author %}Person{% else %}Organization{% endif %}",
    "name": "{{ author or metadata.author }}"{% if not author %},
    "url": "{{ metadata.url }}"{% endif %}
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ metadata.brandName or metadata.title }}",
    "url": "{{ metadata.url }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ metadata.url }}/img/favicon/apple-touch-icon.png"
    }
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ pageUrl }}"
  }
  {% if tags %},
  "keywords": "{{ tags | filterTagList | join(', ') }}"
  {% endif %}
}
</script>
{% endif %}

{# BreadcrumbList for better search appearance #}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "{{ metadata.url }}"
    }
    {% if tags and 'posts' in tags %},
    {
      "@type": "ListItem",
      "position": 2,
      "name": "Projects",
      "item": "{{ metadata.url }}/projects.html"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ pageTitle | replace('"', '\\"') }}",
      "item": "{{ pageUrl }}"
    }
    {% elif tags and 'news' in tags %},
    {
      "@type": "ListItem",
      "position": 2,
      "name": "News",
      "item": "{{ metadata.url }}/news.html"
    },
    {
      "@type": "ListItem",
      "position": 3,
      "name": "{{ pageTitle | replace('"', '\\"') }}",
      "item": "{{ pageUrl }}"
    }
    {% endif %}
  ]
}
</script>
